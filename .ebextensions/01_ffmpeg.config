# Launch Template Configuration (for new AWS accounts)
option_settings:
  # Force Launch Template Usage
  aws:autoscaling:launchconfiguration:
    RootVolumeType: gp3
    DisableIMDSv1: true
  
  # Instance Configuration
  aws:ec2:instances:
    InstanceTypes: t3.micro
  
  # Python Configuration
  aws:elasticbeanstalk:container:python:
    WSGIPath: "application.py"
  
  # Environment Configuration
  aws:elasticbeanstalk:application:environment:
    FFMPEG_PATH: "/usr/local/bin/ffmpeg"
  
  # Health Check URL
  aws:elasticbeanstalk:application:
    Application Healthcheck URL: "/health"

# Auto Scaling Group Configuration (Correct way)
Resources:
  AWSEBAutoScalingGroup:
    Type: "AWS::AutoScaling::AutoScalingGroup"
    Properties:
      HealthCheckType: ELB
      HealthCheckGracePeriod: 300

# FFmpeg Installation
files:
  "/tmp/ffmpeg-release-amd64-static.tar.xz":
    mode: "000644"
    owner: root
    group: root
    source: https://johnvansickle.com/ffmpeg/releases/ffmpeg-release-amd64-static.tar.xz

commands:
  01_install_ffmpeg:
    command: |
      cd /tmp
      tar -xf ffmpeg-release-amd64-static.tar.xz
      cp ffmpeg-*-amd64-static/ffmpeg /usr/local/bin/
      chmod +x /usr/local/bin/ffmpeg
      ln -sf /usr/local/bin/ffmpeg /usr/bin/ffmpeg
      rm -rf /tmp/ffmpeg-*
    ignoreErrors: true
